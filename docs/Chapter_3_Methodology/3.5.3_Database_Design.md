# 3.5.3 Database Design

The Nexus platform relies on a document-oriented data model that balances flexibility with the integrity requirements of ticketing and payment workflows. MongoDB, accessed via Mongoose, stores JSON-like documents that map directly to the JavaScript domain objects used by the API. Strategic indexes and explicit references preserve relational semantics, enabling efficient joins while supporting rapid iteration.

## Entity Relationship (ER) Diagram Narrative
The ER diagram centres on three core entities—`User`, `Event`, and `Ticket`—while acknowledging derived relationships to payment gateways and notification logs.

- A **User** may create zero or many **Events** (one-to-many). Each event references its owning user through the `organizer` field, ensuring accountability and enabling organizer-specific dashboards.
- A **User** may also possess zero or many **Tickets** (one-to-many). Tickets reference both the purchaser (`user`) and the associated event.
- An **Event** can aggregate zero or many **Tickets** (one-to-many). This relationship captures actual attendance, drives RSVP counts, and underpins organizer revenue analytics.

Supporting entities (e.g., `Feedback`, `Payment` records) link back to these core collections, but the principal referential integrity constraints are enforced through `ObjectId` references between `User`, `Event`, and `Ticket`.

## Schema Definitions
The following schemas are extracted from the current Mongoose models and describe the persisted attributes, types, and constraints.

### User Collection (`server/models/User.js`)
- `name: String` – required full name of the account holder.
- `email: String` – required, unique identifier used for authentication and communication.
- `password: String` – required, bcrypt-hashed credential.
- `role: String` – enumeration of `student`, `organizer`, or `admin`, defaulting to `student`.
- `organizationName: String` – optional label for organizer-affiliated societies or clubs.
- `createdAt: Date` – defaults to `Date.now`, capturing account creation timestamp.
- `profilePicture: String` – URL to an avatar image, defaulting to `/images/default-avatar.jpeg`.
- `notificationReads: [String]` – array of notification identifiers already acknowledged by the user.
- `accentPreference: String` – enumeration of `blue`, `purple`, `green`, or `orange` to customise UI theming.
- `brandColor: String` – hex colour selected by organizers for branding; defaults to `#2563EB`.
- `avatarRingEnabled: Boolean` – toggles decorative styling around profile avatars.
- `interests: [String]` – tags used for personalised recommendations on the guest dashboard.

### Event Collection (`server/models/Event.js`)
- `title: String` – required event name.
- `description: String` – required narrative summary.
- `date: Date` – required start date/time used for scheduling and gating ticket check-in.
- `location: String` – required venue description.
- `locationLatitude: Number` – optional geospatial coordinate for map integration.
- `locationLongitude: Number` – optional geospatial coordinate complementing latitude.
- `organizer: ObjectId` – required reference to the `User` who created the event.
- `status: String` – enumeration of `pending`, `approved`, or `rejected`, defaulting to `pending` for admin moderation.
- `isFeatured: Boolean` – flag for promoting highlight events on guest dashboards.
- `category: String` – required categorical label (e.g., `Technology`, `Arts`, `Sports`).
- `capacity: Number` – optional attendance limit used for validation and analytics.
- `ticketsSold: Number` – counter reflecting confirmed ticket purchases.
- `registrationFee: Number` – cost per ticket for reserve pricing workflows.
- `price: Number` – base price field retained for compatibility with legacy flows.
- `tags: [String]` – descriptive keywords enabling filtering and search.
- `rsvpCount: Number` – aggregate RSVP metric supporting organizer insights.
- `imageUrl: String` – optional media asset for marketing visuals.
- `timezone: String` – optional indicator for multi-timezone scheduling.
- `endDate: Date` – optional end date for multi-day events.
- `endTime: String` – optional textual representation of ending time.
- Automatic timestamps (`createdAt`, `updatedAt`) are injected via Mongoose schema options.

### Ticket Collection (`server/models/Ticket.js`)
- `user: ObjectId` – required reference to the purchasing `User`.
- `event: ObjectId` – required reference to the corresponding `Event`.
- `quantity: Number` – number of seats included in the transaction, defaulting to 1 with a minimum constraint.
- `status: String` – enumeration of `pending`, `confirmed`, or `checked-in`, defaulting to `confirmed`.
- `paymentReference: String` – Paystack-generated transaction identifier for reconciliation.
- `amountPaid: Number` – monetary value captured for analytics and refund logic.
- `checkedInAt: Date` – timestamp recorded when QR code validation succeeds at the venue.
- `email: String` – contact address used when a ticket is issued without a registered account.
- `metadata: Object` – flexible structure for storing payment channel data, coupon usage, or seat assignments.
- Compound index: `{ event: 1, user: 1 }` with `unique: true` to prevent duplicate ticket issuance per user-event pair.
- Automatic timestamps record creation and update instants.

By enforcing explicit references and enumerated statuses, the database design supports transactional reliability (e.g., ensuring a guest cannot double-purchase the same event) while enabling expressive queries for dashboard analytics and operational reporting.
